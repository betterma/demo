{"./":{"url":"./","title":"Introduction","keywords":"","body":"IntroductionIntroduction "},"focus.html":{"url":"focus.html","title":"云桌面运营后台操作手册","keywords":"","body":"1. 卷类型相关2.创建虚拟机流程运营管理平台是创建云桌面的基础，在部署完成openstack（简称os，下同）和ceph集群时，可以前往运营管理平台按照以下流程进行操作。 运营后台资源和OS资源逻辑关系如下， 1. 卷类型相关 目前部署的OS集群默认的volume_backend_name有两个，ceph-vm，ceph-data，运营后台数据库初始化会初始这两条数据。 磁盘类型：磁盘类型是定义的逻辑概念，便于用户理解，有“高速云盘”、“普通云盘”等，磁盘类型创建的时候可以填写QOS的相关指标，主要有六项，read_iops_sec、write_iops_sec等，这里并没有真正创建OS的qos。卷类型：卷类型创建的时候会选择作为系统盘还是数据盘，如果作为系统盘，使用的volume_backend_name只会是ceph-vm，如果作为数据盘，使用的volume_backend_name只会是ceph-data。创建卷类型会关联磁盘类型，如果磁盘类型有qos指标，我们就会去OS创建qos并关联这个卷类型，qos在运营后台不感知，便于用户操作。一个卷类型只能关联一个磁盘类型，一个磁盘类型可以被两种（数据盘、系统盘）卷类型关联，即两个系统盘的卷类型不能关联一个磁盘类型，两个数据盘的卷类型不能关联一个磁盘类型。 2.创建虚拟机流程 运营后台 1) 镜像启动 运营后台初始化的镜像有个启动过程，就是选择磁盘类型（卷类型）创建卷生成卷快照，用卷快照创建虚拟机比较快。 业务后台 1）创建桌面 选择运营的镜像生成的卷快照创建系统卷，数据盘镜像加磁盘类型创建数据盘，这样桌面登录就可以直接看到数据卷，不用再手动格式化。 2）保存镜像快照 即是业务平台的保存私有镜像，生成对应的系统卷快照和数据卷快照。 3）用私有镜像创建桌面 用上一步保存的系统卷快照创建系统盘，数据盘镜像加磁盘类型创建数据盘。 "},"chapter1-resource/":{"url":"chapter1-resource/","title":"1. 资源池","keywords":"","body":"运营后台的资源池管理数据中心、ceph集群、os集群。 "},"chapter1-resource/os.html":{"url":"chapter1-resource/os.html","title":"1.1 os资源池","keywords":"","body":"1.1 OS集群1. 新建资源池2. 完善资源池1.1 OS集群 1. 新建资源池 点击“资源池”→“os资源池”，“新建资源池”，os集群已经部署完毕，这里把相关信息添加进来。根据自动化部署os的信息填写，参数解释如下： 资源池名称 定义一个资源池的名称，例如：广东资源池、北京资源池等，是一个大区的概念，对应os中的资源keystone 资源池地址 填写该资源池的keystone地址，只写ip即可，例如：192.168.1.1 用户名 默认写admin 密码 根据OS部署的密码填写，自动化部署的时候入库的密码不正确，可以在这里编辑为正确的密码 如下图所示： 2. 完善资源池 添加资源池之后，会看到这个资源池下有两级，分别表示区域（对应os的region），可用区（对应os的az），这些信息是上一步添加资源池的时候自动获取的。 完善region和az的相关信息。 region region的名称可以自定义，例如广州region1、深圳region1等，便于区分即可。根据自动化部署的信息填写cpu超配比、网络管理台地址、网络工具箱地址、监控面板地址、promethus地址、kafka地址、EADP日志地址、rabbitmq地址。 这些信息不需要必填，后续可以补全。 az 可用区可以表示为一个机房的概念，可以自定义名称便于区分，例如：广州可用区1、广州可用区2、深圳可用区1等。 "},"chapter1-resource/ceph.html":{"url":"chapter1-resource/ceph.html","title":"1.2 ceph集群","keywords":"","body":"1.2 创建ceph集群1.2.1 pool管理1.2 创建ceph集群 ceph集群是os的存储资源，点击“资源池”→“ceph集群”，如下，显示ceph集群列表，并显示ceph集群的存储总量和已经使用量。 1.2.1 pool管理 pool是ceph中池的概念，os中卷后端名称对应pool，在ceph集群列表中可以查看pool列表以及相关的存储空间，点击“pool管理”即可查看。 "},"chapter2-storage/storage.html":{"url":"chapter2-storage/storage.html","title":"2. 存储资源","keywords":"","body":"把存储资源的操作顺序放在了计算资源的前面，因为计算资源中镜像的启动依赖于磁盘类型。 "},"chapter2-storage/disktype.html":{"url":"chapter2-storage/disktype.html","title":"2.1 磁盘类型","keywords":"","body":"2.1 磁盘类型2.1 磁盘类型 磁盘类型是运营后台定义的逻辑规则，比较常用的有高速云盘、普通云盘、低速云盘、SSD高速云盘等，给用户创建卷快照时或者创建模板时使用。 针对安全问题，这里可以选择是否加密，但是加密只会对数据盘进行加密，系统盘不会加密，加密会对性能有一定的影响。创建磁盘类型的时候可以设置IOPS限速规格，磁盘类型的6项iops指标可以不填写，不填写表示不限速。一般填写read_iops_sec和write_iops_sec即可 ，不限速的情况下read_iops_sec大概7000左右 ，write_iops_sec大概350左右，可以根据需求填写相应的iops ，write_bytes_sec类似于U盘拷贝文件时的速度，注意单位是Bytes ，例如U盘拷贝文件时的速度是30m/s，那这里的数值就是30000000，read_bytes_sec是读的速度。参数解释： read_iops_sec：随机读IOPS,不限速最高7000左右 write_iops_sec：随机写IOPS，不限速情况下最高350左右 total_iops_sec：前面两者的和 read_bytes_sec：顺序读的速度，即每秒读取多少Bytes write_bytes_sec：顺序写的速度，即每秒写多少Bytes total_bytes_sec：前面两者的和 点击菜单“存储资源”→“磁盘类型”，点击“新建磁盘类型”，创建即可。 "},"chapter2-storage/volume_type.html":{"url":"chapter2-storage/volume_type.html","title":"2.2 卷类型","keywords":"","body":"2.2 卷类型2.2.1 卷后端名称2.2.2 卷类型2.2 卷类型 卷类型的创建可以在运营后台操作，卷类型是OS的资源，这里创建会在OS上创建卷类型。 2.2.1 卷后端名称 切换“卷后端名称”tab页，查看region下卷后端名称列表，os卷后端名称和ceph的pool一一对应，最好根据AZ筛选，一个az对应一个ceph。 创建卷类型的时候需要选择卷后端名称，就相当于选择了ceph的一个池，该卷类型相关的存储都会写到这个池里面。卷后端名称可以关联租户，如果某个池只想给一个租户使用，将该卷后端名称管理租户即可。 2.2.2 卷类型 点击菜单“存储资源”→“卷类型”，点击“新增”按钮， 选择2.1节创建的磁盘类型，填写名称前缀，选择可用区，选择卷后端名称，可以多选，创建即可。注：这里会创建多个卷类型，选择了多少个卷后端名称就会创建多少个卷类型，但是每个卷后端名称只会创建一个卷类型。 注：卷后端名称都会带有“data”或者”vm“，其中，带有data的表示用于数据盘存储，带有vm的表示用于系统盘存储。 新增系统卷的卷类型，记得去创建相应镜像和此卷类型对应磁盘类型的卷快照，请参考2.3 "},"chapter2-storage/volume.html":{"url":"chapter2-storage/volume.html","title":"2.3 卷","keywords":"","body":"2.3 卷2.3 卷 卷会展示所有的列表信息，详情。 点击卷的名称可以查看详情： "},"chapter2-storage/snapshot.html":{"url":"chapter2-storage/snapshot.html","title":"2.4 卷快照","keywords":"","body":"2.3 卷快照2.3 卷快照 卷快照是基础镜像和磁盘类型生成的OS资源，使用卷快照可以快速创建虚拟机，体验较好，所以会现在运营后台创建好卷快照，云桌面业务平台可以根据基础镜像和磁盘类型匹配到卷快照，进而快速创建云桌面。在启动基础镜像的时候会默认选择创建卷快照，这里一般不需要创建卷快照。在这里创建卷快照的情形是：新增了系统盘的卷类型以及磁盘类型，业务平台需要新建磁盘类型的卷快照创建桌面，这里可以选择基础镜像和磁盘类型进行创建。 点击卷快照名称可以查看详情 "},"chapter3-compute/compute.html":{"url":"chapter3-compute/compute.html","title":"3. 计算资源","keywords":"","body":""},"chapter3-compute/host.html":{"url":"chapter3-compute/host.html","title":"3.1物理主机","keywords":"","body":"3.1 物理主机3.1 物理主机 选择资源池和可用区进行物理主机查看,可以查看os物理主机的vcpu、内存、存储的总量以及使用量。 "},"chapter3-compute/image_base_file.html":{"url":"chapter3-compute/image_base_file.html","title":"3.2镜像文件","keywords":"","body":"3.2 镜像文件3.2 镜像文件 镜像文件类似于装系统的IOS文件,运营后台统一管理。镜像制作人员将镜像文件制作完毕之后可以上传至FTP文件服务器，运营后台会提供文件服务器的IP、端口、用户、密码，镜像文件制作人员使用客户端登录上传即可，两种方法：1. windows端客户端使用FileZilla，下载地址：https://www.filezilla.cn/download/client ,可以下载64位绿色安装版。上传文件的IP和端口可以在自动化部署的时候指定，默认的用户和密码是admin，admin。2. linux端使用ftp命令如下图： 在put文件之前记得执行binary命令，这样上传的文件就会保持一致，MD5值不会改变。 镜像制作人员将镜像文件上传之后，在运营后台点击“同步”，可以获取镜像文件列表。 选取需要发布的镜像文件，点击发布，选择集群，就可以将该镜像文件发布到OS集群。发布镜像的过程需要花费一段时间，带宽越好，速度越快，一般需要7分钟左右。 注： 这里有一个镜像文件必须发布到OS集群，不然无法创建数据盘，镜像文件的名字为：Windows-Data-Disk-NTFS-1G.qcow2，大小为8MB。 "},"chapter3-compute/image.html":{"url":"chapter3-compute/image.html","title":"3.3基础镜像","keywords":"","body":"3.3 基础镜像3.3 基础镜像 基础镜像是OS的资源,3.2节将镜像文件发布到OS集群制作基础镜像。 基础镜像默认不需要同步，如果有些镜像过大，无法通过FTP发布，可以在os上上传镜像，然后同步。同步之后默认不启用，请点击“启用”按钮进行启用。 镜像启用会默认选择创建卷快照，卷快照已经在2.3节介绍。运营后台会根据基础镜像的名字后缀自动填写卷快照的大小，如果基础镜像的名字后缀没有带上大小，需要自己填写，这里需要注意，大小最好咨询镜像制作人员，卷快照的大小就是基础镜像系统盘的大小。 注： 这里有一个镜像不需要启用，镜像的名字为：Windows-Data-Disk-NTFS-1G.qcow2，大小为8MB，它用作创建数据盘。 "},"chapter3-compute/vm_host.html":{"url":"chapter3-compute/vm_host.html","title":"3.4 虚拟主机","keywords":"","body":"3.4 虚拟主机3.4 虚拟主机 运营后台这边也提供查看虚拟主机的功能，可以根据租户、资源池、可用区筛选，查看虚机的详情。 "},"chapter4-network/network.html":{"url":"chapter4-network/network.html","title":"4.网络资源","keywords":"","body":"4.14.1 网络资源目前只提供查看功能，可以查看网络拓扑、设备网络、流量分析。接入的是网络组的管理台页面。 可以在OS集群详情查看配置的网络管理台地址 "},"chapter5-monitor/monitor.html":{"url":"chapter5-monitor/monitor.html","title":"5.监控告警","keywords":"","body":"5. 监控告警5.1 监控面板5.2 配置邮箱服务器5.3 接收组5.4 告警订阅5.5 查看告警信息5. 监控告警 5.1 监控面板 点击菜单“监控告警” → “监控面板”，可以查看每个数据中心对应的监控面板，点击可以跳转到grafana图形界面，可以查看各种指标。 5.2 配置邮箱服务器 邮箱服务器用于发送邮件，例如告警信息、修改密码确认等。目前邮件服务器的配置在“系统配置单数”中管理。点击“系统管理”→“配置参数管理”，搜索“STMP服务器配置”，如下图点击“编辑”，配置邮件服务器参数接口。 注：目前邮件服务器参数以JSON字符串形式存储，改动的时候不要改动格式。 5.3 接收组 接收组可以配置接收方的邮箱或者办公助手账号点击菜单“监控告警”→“接收组”，点击按钮“新增接收组”，填写相关信息即可。 5.4 告警订阅 点击菜单“监控告警”→“告警订阅”，点击按钮“订阅告警”，填写相应的信息即可 5.5 查看告警信息 点击菜单“监控告警”→“告警信息”，或者“监控告警”→“告警指标”，查看相应的告警信息。 "},"chapter6-resource_assign/resource_assgin.html":{"url":"chapter6-resource_assign/resource_assgin.html","title":"6.资源分配","keywords":"","body":"6. 资源分配6.1 新建租户6.2 分配资源6.3 设置租户配额6. 资源分配 资源分配主要用于创建租户，并给租户分配OS集群使用 6.1 新建租户 租户申请需走线下审批流程，审批通过后才允许线上创建租户 点击“资源分配”→“租户资源”→“新建租户”，    6.2 分配资源 选取新建的租户，点击“关联openstack集群”，   选择az，这时会给租户去os中创建相应的domain、projet、user、vpc，然后该租户的管理员可以登录云桌面业务平台去创建桌面了。 6.3 设置租户配额 租户配额规定了租户可以使用多少CPU、内存、系统盘（各种磁盘类型）、数据盘（各种磁盘类型），给租户设置即可。 "},"chapter7-question/question.html":{"url":"chapter7-question/question.html","title":"7.常见疑问","keywords":"","body":"1. 给租户关联OS失败1. 给租户关联OS失败 出现这种问题的一般原因是存在同名的域或者项目，给租户分配OS使用，会在os集群创建域（租户名）、项目（租户名-default），可以采用os命令查看，在os的controller节点上操作 . admin-openrc openstack domain list (查看是存在要创建的域) openstack project list （查看是否存在要创建的项目） 如果域存在，请确认要创建的域是否已经被使用，不确认请请教专业人士，不要操作，如果确认可以操作 openstack set domain 域名 --disable openstack domain delete 域名 如果存在要创建的项目名，同理，确认可以自己操作的情况下，执行 openstack project delete 项目名 "}}